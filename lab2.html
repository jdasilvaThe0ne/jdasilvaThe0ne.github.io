<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Lab 2 ‚Äì Core ROS 2 Concepts and </title>
  <link rel="stylesheet" href="assets/css/style.css">
  <script>
  // Initialize votes if not present
  if (!localStorage.getItem('agreeVotes')) {
    localStorage.setItem('agreeVotes', 0);
    localStorage.setItem('disagreeVotes', 0);
  }

  function updateDisplay() {
    document.getElementById('agreeCount').textContent =
      localStorage.getItem('agreeVotes');
    document.getElementById('disagreeCount').textContent =
      localStorage.getItem('disagreeVotes');
  }

  function vote(type) {
    let count = parseInt(localStorage.getItem(type + 'Votes'));
    localStorage.setItem(type + 'Votes', count + 1);
    updateDisplay();
  }

  updateDisplay();
</script>

</head>
<body>

  <!-- Profile (Top Left) -->
  <div class="profile">
    <img src="assets/img/me.jpeg" alt="Justino DaSilva">
    <span>Justino DaSilva</span>
  </div>

  <!-- Sidebar Navigation -->
  <nav class="sidebar">
    <h2>ROS 2 Labs</h2>
    <ul>
      <li><a href="index.html">Home</a></li>
      <li><a href="lab1.html">Lab 1 ‚Äì Getting Started</a></li>
      <li><a href="lab2.html">Lab 2 ‚Äì Core Concepts</a></li>
      <li><a href="lab3.html">Lab 3 ‚Äì URDF & RViz2</a></li>
      <li><a href="lab4.html">Lab 4 ‚Äì Simulation & Control</a></li>
    </ul>

    <hr>

    <ul>
      <li><a href="#config">Configuring ROS</a></li>
      <li><a href="#turtlesim">Turtlesim</a></li>
      <li><a href="#nodes">Nodes</a></li>
      <li><a href="#topics">Topics</a></li>
      <li><a href="#services">Services</a></li>
      <li><a href="#parameters">Parameters</a></li>
      <li><a href="#actions">Actions</a></li>
      <li><a href="#rqt">rqt & rosbag</a></li>
      <li><a href="#launch">Launch Files</a></li>
      <li><a href="#choreo">Turtle Choreography</a></li>
    </ul>
  </nav>

  <!-- Main Content -->
  <main class="content">

    <!-- Section 1 -->
    <section id="config">
      <h2>Configuring ROS</h2>

      <p>
        Before using ROS 2 commands, the environment must be sourced. This sets
        required environment variables so that ROS packages and tools can be
        discovered by the system.
      </p>

      <pre>
source /opt/ros/jazzy/setup.bash
      </pre>

      <p>
        Or it can  added  to the .bashrc file  and when you are ready to use 
        simply enter the command source .bashrc  instead. <b>Note</b> you must  be in your home directory
        before running these commands
<pre>
echo "source /opt/ros/jazzy/setup.bash" >> .bashrc 
source .bashrc 
</pre>
        To confirm the installation, the ROS 2 version ( on windows using wsl)  use the command: if it fails
        you may need to install  "pip"   here we see we are using <b> ROS version 0.32.6</b>
      </p>

      <pre>
pip show ros2cli
      </pre>

      <!--div class="placeholder"-->
    <div class="ros-screenshot">
  <img src="assets/img/ros2_version.png"
         alt="ROS version">
   <div class="ros-caption">
      ROS_version
    </div>
</div>

    
      <!--/div-->
    </section>

    <!-- Section 2 -->
    <section id="turtlesim">
      <h2>Simulation  with turtlesim</h2>

      <p>
        Ros2 commes with the default robot simulator <strong>turtlesim</strong>  which ovides a simple 2D simulator that
        helpu you to understand core concepts of ROS2 such as nodes, topics, services, and
        parameters.  To have a feel of what im referring, use the same terminal as before and execute
        the below commands.
      </p>

      <pre>
ros2 run turtlesim turtlesim_node
ros2 run turtlesim turtle_teleop_key
      </pre>

      <p>
        The teleoperation(telop) node publishes movements commands that control the turtle‚Äôs
        movement using the keyboard a total of 8 keys is available for moving the robot(turtle).
      </p>

     <div class="ros-screenshot">
        <img src="assets/img/node_key.png"
             alt="control buttons">
        <div class="ros-caption">
             Movement Keys </div>
     </div>

    </section>

    <!-- Section 3 -->
    <section id="nodes">
      <h2>Understanding Nodes</h2>

      <p>
        A node is an executable that uses the ROS 2 API to perform a specific tas
        within a robotics system. Much like a graph have vertices Robots(or Robot Operating System) work with  multiple components 
            that are called Node. They allow the robot to achieve syncronization with the different  robtos parts.  Nodes  connect to 
            each other to intechange or communicate data  via topics, services  or actions. According to <a  href="https://arxiv.org/pdf/2305.09933"> 
                Impact of ROS2 Node Composition  in Robotic System</a> where more detailed can be found. There are three types of Nodes:
            <li> Node ( without Qualifier) much like a constructer in a object oriented programming 
                language
            <li>Lifecycle Nodes</li> 
            <li>Composition Nodes
      </p>

      
        
       <div class="vote-box">
        <p><strong>Statement:</strong> A node is an executable that uses ROS 2 APIs.</p>

        <button onclick="vote('agree')">Agree</button>
        <button onclick="vote('disagree')">Disagree</button>

        <p>
            üëç Agree: <span id="agreeCount">0</span> |
            üëé Disagree: <span id="disagreeCount">0</span>
        </p>
        </div>

  
        </div>

      </p>

      <p>

        To see which nodes are  active  and determine the status of its attributes  use 
        use the below command.  In this case only the turtlesim_node is running so only this node is displayed. 
      </p>

      <pre>
ros2 node list
ros2 node info /turtlesim
      </pre>

      <div class="ros-screenshot">
        <img src="assets/img/nodelist_info.png"
             alt="node lis">
        <div class="ros-caption">
             list of node and detail on the turtlesim node  </div>
     </div>
    </section>

    <!-- Section 4 -->
    <section id="topics">
      <h2>Understanding Topics</h2>

      <p>
        <strong>Analogy:</strong> T
        In the section above we spoke about Nodes,and stated that the communicate with each other to achieve syncronization,  
        across the differnt hardware and software components  across the robot. For communication ( the edge of the graph)
        ROS 2 uses what are called topics. Topics are like a constant line of output where  an output 
        can be published/written  and read by multiples nodes.  this constant update, read/write  allows all each Nodeto know the
         status of it neighbours in real time. It functions  simalar to a broadcast message or group chat. 
          
         <br><br>In RoS2 there are always two topics running(listening) 
        <li> /paramter_events</li>
        <li> rosout</li>
        </p>
        <p>
         run  the below command  you'll see  three additional topics added. 
      </p>
      
      
      <!--p>
        Topics that are currently active can be listed and inspected:
      </p-->

      <pre>
ros2 topic list
ros2 topic info /turtle1/cmd_vel
      </pre>
       <div class="ros-screenshot">
        <img src="assets/img/topics.png"
             alt="node lis">
        <div class="ros-caption">
             list of node and detail on the turtlesim node  </div>
     </div>
      <p>
        imfomation being posted to topic could be observed using the echo command let's
        let's  view the position of the turtle using the commands below.   The second comand 
         cause the turtle  to move in a circle. 
      </p>

      <pre>
ros2 topic echo /turtle1/pose
      </pre>
       
         <div class="video-container">
        <video controls>
            <source src="assets/videos/infinite_cycle_pose..mp4" type="video/mp4">

            <!-- Captions -->
            <track src="captions.vtt" kind="subtitles" srclang="en" label="English" default>
        </video>
        </div>
         <p class="error">
         Note in my installation(WSL) the topic "pose" keeps cycling see video below.  
         The ubuntu installation however does not behaive this way,  it just    prints 
         it once ans waits for  other instructios. In my opinion this data should 
         only be updated when the simulator is given and instruction. for example
           when on of the arrow key is pressed which cause the turtle on the simulator  to react
       </p>

      <p>
        Publishing to a topic sends commands directly to the turtle: for example the 
        command <code> ros2 topic pub /turtle1/cmd_vel geometry_msgs/msg/twist "{linear: {x: 2.0}, angular: {z: 1.5}}"
      </code> tells ros to move the turtlesim in cirtular manner  see video below. here you can 
      see the action being repeated indefinitly  as it goes round and round.  
      </p>

      <pre>
ros2 topic pub /turtle1/cmd_vel geometry_msgs/msg/Twist "{linear: {x: 2.0}, angular: {z: 1.5}}"
      </pre>

      <div class="video-container">
        <video controls>
            <source src="assets/videos/circle_turtle.mp4" type="video/mp4">

            <!-- Captions -->
            <track src="captions.vtt" kind="subtitles" srclang="en" label="English" default>
        </video>
    </div>
    <!-- Section 5 -->
    <section id="services">
      <h2>Understanding Services</h2>

      <p>
        <strong>Analogy:</strong> Services are like making a phone call. A request is
        sent, and the caller waits for a response before continuing, unlike the topics 
        service are one to one.  a unique channel i created for communication and ends 
        by either  ther server or client.
      </p>

      <p>
        <strong>Topics vs Services:</strong>
      </p>
      <ul>
        <li>Topics stream data continuously.</li>
        <li>Services are used for one-time requests.</li>
      </ul>
      <p>The first commands shows hte list of services  available for call.  <b>Note:</b> if no node is 
    active no services will be available for call</p>

      <pre>
ros2 service list
ros2 service call /clear std_srvs/srv/Empty
      </pre>
     <p>   Command two clear any path that was create by the turle video below   for a clearer
        understanding. If after calling clear  you attempt to move the turtle again you will see
        it move an leave a trace. this is expected as the service call has completed(ended)
        and the state has returned to normal
     </p>
       <div class="video-container">
        <video controls>
            <source src="assets/videos/Erase.mp4" type="video/mp4">

            <!-- Captions -->
            <track src="captions.vtt" kind="subtitles" srclang="en" label="English" default>
        </videeo>
        </video>
    </section>

    <!-- Section 6 -->
    <section id="parameters">
      <h2>Understanding Parameters</h2>

      <p>
        <strong>Analogy:</strong> Parameters are like robot preferences or settings
        that can be adjusted without changing the program code. thing that can passsed
        directly to the th robot for example in a real robot  a paramerter could be  "turn on  head light 
        brightness 75%", or night vision enable  if time >16:00. 
      </p>

      <p>
        Parameters are useful in testing, development, and production environments
        where behavior must be tuned dynamically fo the robtot to interact with it's environment 
        intelligently. By setting  the red and blue color to 55 and the the green to 255 you ge the color shown in the image 
        below
      </p>

      <pre>
ros2 param list /turtlesim
ros2 param set /turtlesim background_r 255
      </pre>



      <div class="ros-screenshot">
        <img src="assets/img/parameter.png"
             alt="node lis">
        <div class="ros-caption">
             list of node and detail on the turtlesim node  </div>
     </div>
    </section>

    <!-- Section 7 -->
    <section id="actions">
      <h2>Understanding Actions</h2>

      <p>
        Actions are similar to services but are designed for long-running tasks.
        They provide feedback and allow goals to be canceled. This behaivour is becessary 
        as the robot environment may change  dynamically.  for examale if instruction is given
        to the robot  move forward 12 feet but at feet 11  it hits  a wall. the feedback
        provided by the by the action will allow the  instuction to be terminately 
        prematurely. Or for a new instrtion to be given. 
      </p>

      <p>
        <strong>Actions vs Services:</strong> Actions are used when execution time
        is significant or progress feedback is required as described above. This is necessay given
        that. not because you can do something means you should do it.  For example. if a robot is at the end of a cliff;
        technically i can go forward. but the feed back may allow the central monitor to send a halt 
        or danger-stop instruction. Below  we see that  the action available for the turtle is 
        <b>turtle1/rotate_absolute</b>  in the video  theta means move the turtle 90 degree. counter 
        clockwise.  <b>Note</b> if the turle is already  at  90 degree with respect to zero 
        so don't think your turtle is broken when yoy don't see it move the second time i.e the new value must be differrent
        if you  expect the turtle to move. 
      </p>

      <!--pre>
ros2 action list
      </pre-->

      <div class="video-container">
        <video controls>
            <source src="assets/videos/rotate.mp4" type="video/mp4">

            <!-- Captions -->
            <track src="captions.vtt" kind="subtitles" srclang="en" label="English" default>
        </video>
  
    </section>

    <!-- Section 8 -->
    <section id="rqt">
      <h2>Using rqt_console, rqt_graph, and rosbag</h2>

      <p>
          Rqt console is a graphical user interface  that  
          Allows you to see log messages  in a very user friendly manner, message that would ususally be 
          seen in the cli. it provide filters options that alow you to do debugging
          more easily. There is the option to also highlight particular keywords making searches standout.
          in the imaage below you see the  same messges in the rqt_conosle(right)  in the left (terminal)

      <div class="ros-screenshot">
        <img src="assets/img/Rqt_console .png"
             alt="node lis">
        <div class="ros-caption">
             Terminal and rqt_console with message  </div>
     </div>
      </p>

      <pre>
rqt_graph
      </pre>
      <p>
        By running the above command <code>rqt_graph</code>  a visual representation of the simulated robot is shown. In this case
        we have two nodes available. <code>teleop_turtle </code> and <code> turtlesim</code> it also displays  the relationship between 
        these town nodes such as the <code>topic</code> and <code>action</code>
      </p>
      <div class="ros-screenshot">
        <img src="assets/img/rqt_graph.png"
             alt="rqt_graph">
        <div class="ros-caption">
             rqt_graph  with two nodes <b>teleop</b> and <b>turtlesim</b></div>
     </div>

      <p>
        <strong>rosbag</strong>: Rcording  and replaying events: Many times we want to  replay some actions as a demonstration for others. Rosbag allow us to do hits
        it records data on nodes such as topics, sevices  and timestamps into a .bag file  so that thye can be replayed. It helps with debugging as 
        <div class="ros-screenshot">
        <img src="assets/img/dataflow_rosbag.png"
             alt="rqt_graph">
        <div class="ros-caption">RosBag Visual representation <br> <a href=https://www.reduct.store/blog/store-ros-topics>https://www.reduct.store/blog/store-ros-topics</a></div>
     </div>
      </p>
      <p><b>Advantages</b>
           <ul>
            <li>it is very good  for debuging  as you can replay events over and over 
            </li>
            <li>so indentfy what's causing the error.</li>
            <li>since it records  topic message the can be analyzed even when the robot is offline</li>
            <li>this offline debuggin allows for precise documentation of issues an successes</li>
          </ul>
          </p>
            
      <p><b>Disadvantages</b></p>
    <ul>
      <li>
        <b>No advanced Filtering</b> It's made for debugging but does not have an advance 
      tool for filtering and quering data    </li>
      <li>No built int GUI</li> Rosbag is commandline and has no built in
       graphical user interface so everything must be done throught the terminal which is quite tedious 
    </ul>

      <pre>
ros2 bag record -a
      </pre>


      <div class="video-container">
        <video controls>
            <source src="assets/videos/rosbagplayback.mp4" type="video/mp4">

            <!-- Captions -->
            <track src="captions.vtt" kind="subtitles" srclang="en" label="English" default>
        </video>
    </section>

    <!-- Section 9 -->
    <section id="launch">
      <h2>Launching Nodes</h2>

      <p>
        Launch files allow multiple nodes to be started with a single command,
        similar to starting an entire project with one click. For example so far we needed to open  a minimum of to terminals to  use the turtle simulator
        <ol>
          <li>turtlesim</li>
          <li>teleop_turtle</li>
        </ol>
      Launch files can be created using three methods, <code> XML, YAML or Python</code> in this toturial we will be using Python if you wish to try the other methods please foloow <a href="https://docs.ros.org/en/humble/Tutorials/Intermediate/Launch/Creating-Launch-Files.html"> this tutorial</a> 
      </p>
      <b>Python Lauch file, example code</b> 
      <b>Note</b> xterm must be installed before running the launch file  elese nothing will happen
      when you  press the corresponding keys to move.  much like when you run turtlesim and teleop_turtle  they
      need to be in diffrent terminals( independent terminals) to capture keyboard input. 

      <pre>

from launch import LaunchDescription
from launch_ros.actions import Node
from launch.actions import ExecuteProcess
   
def generate_launch_description():
    return LaunchDescription([

        # Start turtlesim normally
        Node(
            package='turtlesim',
            executable='turtlesim_node',
            output='screen'
        ),

        # Start teleop in a new terminal window
        ExecuteProcess(
            cmd=['xterm', '-e', 'ros2 run turtlesim turtle_teleop_key'],
            output='screen'
        ),
    ])
      </pre>
    <p>

    </p>

      <div class="video-container">
        <video controls>
            <source src="assets/videos/LaunchFilelab2.mp4" type="video/mp4">

            <!-- Captions -->
            <track src="captions.vtt" kind="subtitles" srclang="en" label="English" default>
        </video>

      
      <div class="ros-caption">launching Tutrlesim and teleop_turtle with a launchfile</div>
    </div>
    </section>

    <!-- Section 10 -->
    <section id="choreo">
      <h2>Turtle Choreography</h2>

      <p>
        This section demonstrates coordinated turtle motion using multiple ROS 2
        features.
      </p>

      <ul>
        <li>Seven turtles named after the seven dwarfs</li>
        <li>Topic publishing using <code>cmd_vel</code></li>
        <li>Service calls to reset and clear the screen</li>
        <li>Parameter changes for background color</li>
        <li>Action goals for precise rotation</li>
        <li>Recording the choreography using rosbag</li>
        <li>A launch file to start the entire performance</li>
      </ul>

      <p>
        <strong>Theme:</strong> The seven dwarfs march together to mine diamonds,
        ending with fireworks at the top corners of the screen.
      </p>

      <div class="placeholder">
        Screenshot: final choreography formation
      </div>
    </section>

  </main>

</body>
</html>
